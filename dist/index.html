<style>*{margin:0;width:100%;height:100%}</style><canvas id="b"><script>var O=Math.sqrt,fa=Math.floor,Q=Math.sin,V=Math.cos,X=Math.min,ja=Math.max,Fa=Math.atan2,Y=Math,Ja=Y.PI,Ka=2*Y.PI,Ma=Y.PI/2,Pa=3*Y.PI/2,Sa=[.4,.2,.4,0],Ta=["#313","#324","#335"],Va=[.05,.03,.03],fb=[1,1,.7],gb=[.8,.8,.5,.7],hb=[.3,.35,.33,0],ib=[.6,.6,.5,.5],jb=[.6,.1,.6,.5],lb=document,sb=localStorage;
function tb(a,c,g,d,e,f,m){function p(a,c){var g=d(111*a+37*c+a+c);if(50>a)if(a--,0>a)var f=0;else{f=a+Y.abs(((c+3*(a>>2))%6+6)%6-2)>>2;var v=void 0;g(2)&&(v=p(a,c))<3*f?f=v:f*=3}else if(f=36,50<a||.1>g())f+=6;return f}var B=ub(e,.4,.2,.1,"sine",777,333),D=ub(e,.5,.4,.2,"square",299,999,0,"sine",30),K=ub(e,.4,.4,.2,"sawtooth",-99,299);return function(e,k,z){for(var n=12*e,v=12*k,u=a+" "+e+" "+k,w=d(111*e+37*k+e+k),b=[],q=p(e,k),I=50==e,r=I&&q>=p(e+1,k),H=-1;1>=H;H++)for(var t=-1;1>t;t++){var G=d(2147483647*
(k>>3+t)+e>>3+H);b.push(G(2147483647))}var J=p(e+1,k),L=p(e,k+1),y=p(e,k-1);H=X(J,y,L);if(G=H>q&&J==H){t=H-q;H=O(144+t*t);var R=Fa(t,12);t=[n,t/12,q+.3,.5];H=c(n,v,q,H,12,e,k,R,0,hb,2/V(R),2,t)}else t=[n,0,q+.3,.5],H=c(n,v,q,12,12,e,k,0,0,hb,2,2,t);H.floor=1;H=[H];J>q&&!G&&(R=J-q,J=c(n+12,v+12,J,R,12,e,k,Pa,Ja,hb,R,2,t),H.push(J));L>q&&(R=L-q,J=c(n,v+12,L,R,12,e,k,Pa,Pa,hb,R,2,t),H.push(J));y>q&&(R=y-q,J=c(n+12,v,y,R,12,e,k,Pa,Ma,hb,R,2,t),H.push(J));G=0<e&&w(2)&&!G&&(50>e||52<e)||I;var ka=(!w(9+
q)||sb.getItem(u)||3>e||50<e)&&!I;if(G){R=X(4+q/4,20)|0;G=w(4)+6;var A=I?4:w(3*e/50)+1;G-=G%A;J=I?12:G;var M=!w(30-L-y+2*q);L=I?20:(M?1:w(R)+4)*A;var N=q;r&&(N+=A);r=I?1:M?G:w(L/4)+1;y=w(4)+1;var ha=[],U=0;R=I?hb:ka?ib:jb;var ia=void 0;if(!M){M=m[w(m.length)];for(ia in M)if(.1>w())break;(M=ia.match(/([A-Z]|^[a-z])[a-z]{2,}/g))&&(ia=M[w(M.length)])}M=function(a,b){b.g!=vb||I||(ha.map(function(b){b.A=a.a}),ca<U&&(ca++,ca>=U?(D(n,v,q),f("BUILDING LIBERATED")):K(n,v,q)))};for(var C={i:-1,v:e,w:k,a:0,
S:function(){},g:wb,ga:function(b,d){if(ca<U){ca=ja(0,ca-d/999);b.R=ja(ca,b.R);var e=b.V(W,da,Bb);if(e){Na-=d;if(0>Na){var c=aa(b.a,b.J,e);c?Na+=99:Aa&&(Na=3E3);Aa=c}e=Fb([e.x,e.y,e.z],[W,da,e.z]);c=O(Gb(e,e));if(c<21+b.J/3&&b.m[Ib].length<30+b.J-c&&3<c&&(xa-=d,0>xa&&(d=w(ha.length),d=ha[d],-.2<Gb([e[0]/c,e[1]/c,e[2]/c],d.B)||d==E))){e=S[d.M];for(var h in e)if(c=e[h],c.va<b.a){delete e[h];c.A=b.a+99;b.D(c);B(c.x,c.y,c.z);la(d,h);xa=199;ya--;break}}}}else ka||(ka=1,sb.setItem(u,1),sb.setItem(a,"["+
W+","+da+","+N+"]"),ha.map(function(b){b.X=[0,0,0,0];b.T=ib}));Oa!=ca&&(b=X(1,ca/U),b*=b,C.U=b,C.I=b*U/1.7,Oa=ca)}},E,ta,pa,Ba=w(3)+1;r--&&1<G&&1<J;){var qa=n+(12-G>>1),Ca=v+(12-J>>1);U+=G*J*L/7;ta=c(qa,Ca,N,L,J,e,k,Ma,0,R,A,A,t,M,2<Ba?ia:null,C);var Wa=c(qa+G,Ca+J,N,L,J,e,k,Ma,Ja,R,A,A,t,M,1<Ba?ia:null,C),Ga=c(qa+G,Ca,N,L,G,e,k,Ma,Ma,R,A,A,t,M,1==Ba?ia:null,C),ma=c(qa,Ca+J,N,L,G,e,k,Ma,Pa,R,A,A,t,M,1==Ba?ia:null,C);N>q&&Ba&&(pa=c(qa+G,Ca,N,G,J,e,k,Ja,0,R,A,A,t,M),ha.push(pa));N+=L;E=c(qa,Ca,N,G,
J,e,k,0,0,R,A,A,t,M);ha.push(Ga,ta,Wa,ma,E);L>>=y;L-=L%A;0>=L?(L=A,G-=2*A,J-=2*A):(G-=A*(w(2)+1)*2,J-=A*(w(2)+1)*2);Ba=0}U=5*O(U)+9;var Ha=U/(A*A)|0,ya=0,ua,na,Aa,x,Na=3E3,Xa,kb=[],S={},xa=0,ca=ka?U:0;t=I?-1:ca/U;C.U=t;C.I=ca*t/1.7;var Oa=ca;for(t=w(3)+1;t--;)kb.push(b[w(b.length)]);var la=function(b,a,d){for(var e=0;24<=a;)a-=24,e++;var c=b.X[e];b.X[e]=d?c|1<<a:c&~(1<<a)},aa=function(b,a,d){for(var e=.45*O(A),c,v=X(9,w(9)+a/99|0);!c&&v--&&ya<Ha;)if(Aa?(ua+=w(3)-1,na+=w(3)-1):(Xa=kb[w(kb.length)],
x=ha[w(ha.length)],ua=w(x.Y/A),na=w(x.ka/A)),c=0<=ua&&0<=na&&ua<x.Y/A&&na<x.ka/A&&(x==ta&&I||!I&&.001>x.B[2]||x==E||x==pa)){var f=Jb((ua+.5)*A,(na+.5)*A,e+.001,x.ra);if(d){var k=Fb([d.x,d.y,d.z],f);c=O(Gb(k,k));c=Gb([k[0]/c,k[1]/c,k[2]/c],x.B);c=!a||-.2<c;if(0<k[2]||x==E)Xa&=-4}if(c){k=na*x.Y+ua;var n=S[x.M];n||(n={},S[x.M]=n);if(c=!n[k])f=g(Xa,f[0],f[1],f[2],e),f.c=.001*x.B[0],f.f=.001*x.B[1],f.va=b+999+w(999),n[k]=f,la(x,k,1),ya++}}return c},W=12*e+6,da=12*k+6;for(e=z.V(W,da,Bb);!ka&&ya<Ha;)aa(0,
0,e);H.push.apply(H,ha);H.push(C)}else 50>e&&!ka&&q&&!w(9)&&(k=b[w(b.length)],e=X(3,.45*(O(e)+1)),e=g(k,n+6,v+6,q+e+3,e,-1,function(){sb.setItem(u,1)}),H.push(e));return H}}var Bb=1,Ib=2,vb=3,wb=4,Vb=[0,1,2,0,2,3];
function Wb(a){var c=0;return function(g,d,e,f,m,p,B,D,K,y,k,z,n,v,u,w){var b=--c,q=Xb(a,[0,0,0,0,f,0,0,0,f,m,0,0,0,m,0,0]),I=f/k,r=m/z;z/=k;k=.02/k;var H=Xb(a,[0,0,z,k,I,0,z,k,I,r,z,k,0,r,z,k]),t=Yb(a,a.ELEMENT_ARRAY_BUFFER,new Uint16Array(Vb));I=Zb(Z(0,1,0,D),Z(0,0,1,K));r=Zb(I,$b(-g,-d,-e));D=Zb(Z(0,0,1,-K),Z(0,1,0,-D));K=Zb($b(g,d,e),D);k=Jb(0,0,1,D);z=Jb(f+.1,m+.1,.1,D);var G=Jb(-.1,-.1,-.1,D),J={o:[X(g+G[0],g+z[0]),X(d+G[1],d+z[1]),X(e+G[2],e+z[2])],u:[ja(g+G[0],g+z[0]),ja(d+G[1],d+z[1]),ja(e+
G[2],e+z[2])]};if(u){d=lb.createElement("canvas");e=d.getContext("2d");g=99*f/m;d.width=99;d.height=g;e.fillText(u,(99-e.measureText(u).width)/2,10);u=e.getImageData(0,0,99,g).data;var L=ac(a,99,g,new Uint8Array(u))}return{i:0,M:b--,B:k,H:[[0,0],[f,0],[f,m],[0,m]],v:p,w:B,Y:f,ka:m,T:y,ta:q,ea:H,X:[0,0,0,0],oa:t,pa:6,$:r,ra:K,aa:I,sa:D,na:n,g:0,la:w,fa:L,S:function(){a.deleteBuffer(H);a.deleteBuffer(t);L&&a.deleteTexture(L)},K:function(){return J},G:v}}}
function bc(a,c,g){function d(g,D,K,y,k,z,n,v){function u(){var b=.005*r()+3E-4*(Y.random()+1),a=r(9)+21;T.push(function(d,c,e){if(e&1&&(d=d.W(l,a+d.J)))return w(d.x,d.y,b,c),1})}function w(b,d,a,c,e){b-=l.x;d-=l.y;if(b||d){c=c*e?e*v:v;d=Fa(d,b);e=Q(d);b=V(d);var f=-d;d=Q(f);var g=V(f);f=l.c*g-l.f*d;d=l.f*g+l.c*d;f>a?0<d?d-=c:d+=c:f+=c;l.c=f*b-d*e;l.f=d*b+f*e}}function b(b){var d=I&Y.pow(2,b)-1;I>>=b;return d}function q(b,d,a,c,e,f,g){var v=[b,d,a];v=O(Gb(v,v));Ha.push(e,f,g,c);Wa.push(b,d,a,v)}var I=
g,r=c(g),H=b(3),t=e(H)%11,B=e(b(2)+1)+ja(1,H-1),J=(b(1)+B)/(B+1),L=b(1),Hb=b(1),R=99*(b(5)+32)*k,ka=(b(2)+1)/(14-t),A=6*b(4)/B,M=b(2)|b(2),N=b(3),ha=1.5*b(1),U=.1,ia=[k/(k+2)],C=[],E=3;N?5<N&&(N&=~(1<<r(N-5)+1)):N|=1<<r(3);if(1==N){var ta=1;var pa=.4;U=.2}else N%2?(ta=.7,pa=.3):(ta=.9,pa=.4);for(;E--;){var Ba=N&1;N>>=1;Ba?(ia.unshift(pa+r()*U),C.unshift(ta+r()*U)):(ia.unshift(0),C.unshift(pa+r()*U))}I=g;var qa=X(1,b(2)/2),Ca=b(2)/4,Wa=[],Ga=[],ma=[],Ha=[],ya=[],ua=[],na=(t%2&&3<B||!L)&&Hb||1==t;qa*=
qa;if(na){var Aa=t+1;var x=3/Aa;var Na=k}else Aa=t,x=3/(2*Aa),Na=V(x)*k;for(var Xa=0,kb=x,S=0;S<t;S++)ua.push(kb),ya.push(B),kb+=Ja/Aa;for(S=0;S<t;S++){for(var xa=ya[S],ca=ua[S],Oa=Xa+L,la=Q(ca)*k*J/V(3/xa),aa=V(ca)*k,W=0;W<xa;W++){var da=(W+S)*A,ba=((W+1)%xa+S)*A,La=ka*Q(ca),Ua=M>>W%2&1?La:0,wa=M>>(W+1)%xa%2&1?La:0,h=Xa*Ja/xa+W*Ka/xa,za=h+Ka/xa,ra=Ga.length,oa=V(h)*la,P=Q(h)*la,va=V(za)*la,Da=Q(za)*la;if(S<t-1){var sa=ya[S+1],Ya=ua[S+1],Ea=(W+S+1)*A,Za=((W+1)%sa+S+1)*A,F=ka*Q(Ya),$a=M>>W%2&1?F:0,
Cb=M>>(W+1)%sa%2&1?F:0,ab=Q(Ya)*k*J/V(3/sa),Qa=V(Ya)*k,bb=Oa*Ja/sa+W*Ka/sa,mb=bb+Ka/sa,nb=V(bb)*ab,ea=Q(bb)*ab,Ra=V(mb)*ab,cb=Q(mb)*ab,ob=r()+.5,pb=r()+.5,qb=(oa+va+Ra)*ob/3,rb=(P+Da+cb)*ob/3,Kb=(2*aa+Qa)*ob/3,Lb=(va+nb+Ra)*pb/3,Mb=(Da+ea+cb)*pb/3,Nb=(aa+2*Qa)*pb/3;q(va,Da,aa,wa,qb,rb,Kb);q(oa,P,aa,Ua,qb,rb,Kb);q(nb,ea,Qa,$a,qb,rb,Kb);q(va,Da,aa,wa,Lb,Mb,Nb);q(nb,ea,Qa,$a,Lb,Mb,Nb);q(Ra,cb,Qa,Cb,Lb,Mb,Nb);Ga.push(ra++,ra++,ra++,ra++,ra++,ra++);L?ma.push(1,0,0,ba,0,1,0,da,0,0,1,Ea,1,0,0,ba,0,1,0,Ea,
0,0,1,Za):(0!=S||na?ma.push(0,1,1,ba,1,1,0,da,1,1,0,Ea):ma.push(0,0,1,ba,0,1,0,da,1,1,0,Ea),S!=t-2||na?ma.push(1,1,0,ba,0,1,1,Ea,1,1,0,Za):ma.push(1,0,0,ba,0,1,1,Ea,0,0,1,Za));h=za}var Db=[],Cc=na?ka:0;0==S&&Db.push(Na);for(S==t-1&&Db.push(-Na);Db.length;){var Ia=Db.splice(0,1)[0];Ga.push(ra++,ra++,ra++);var Ob=r()+.5,xb=(oa+va)*Ob/3,yb=(P+Da)*Ob/3,zb=(2*aa+Ia)*Ob/3;0<Ia?(q(oa,P,aa,Ua,xb,yb,zb),q(va,Da,aa,wa,xb,yb,zb)):(q(va,Da,aa,wa,xb,yb,zb),q(oa,P,aa,Ua,xb,yb,zb));q(0,0,Ia,Cc,xb,yb,zb);na?L?ma.push(1,
0,0,0<Ia?da:ba,0,1,0,0<Ia?ba:da,0,0,1,S*A):ma.push(0,1,1,0<Ia?da:ba,1,1,0,0<Ia?ba:da,0,1,0,S*A):ma.push(0,1,0,0<Ia?da:ba,0,1,0,0<Ia?ba:da,1,0,1,0)}}Xa=Oa}var ec=Xb(a,ma),fc=Xb(a,Wa),gc=Xb(a,Ha),hc=Yb(a,a.ELEMENT_ARRAY_BUFFER,new Uint16Array(Ga));if(Ha.length!=Wa.length)throw"not equal";var T=[];v||(v=3E-5*r()+2E-6);for(var Dc=b(2);Dc--;)u();if(b(1)){var Ec=.01*r()+.001,Pb=r(4)+3,Qb=Pb*Pb;T.push(function(b,d,a){if(a&1&&(b=b.V(l.x,l.y,vb,Pb))){a=b.x-l.x;var c=b.y-l.y;a=a*a+c*c;if(a<Qb)return w(b.x,
b.y,Ec,d,-(Qb-a)/Qb-1),1}})}b(1);if(b(1)){var Rb=.005*r()+3E-4;T.push(function(b,d,a){if(a&1)return.001>Y.abs(l.c)&&.001>Y.abs(l.f)&&(b=6*r(),l.c=V(b)*Rb,l.f=Q(b)*Rb),w(l.x+999*l.c,l.y+999*l.f,Rb,d),1})}if(!b(2)){var Fc=.01*r()+.007;T.push(function(b,d,a){a&2&&Sb.map(function(b){if(!b.i&&.001<b.B[2])return l.h=Fc*b.B[2],2})})}if(T.length){for(var Gc=T.length;Gc--;){var Hc=T.splice(r(T.length),1)[0];T.push(Hc)}1==b(4)&&T.unshift(function(b){l.F(b,l)});if(1==b(2)){var Ic=.6*r()+.1;T.unshift(function(b,
d,a){if(a&1)return b=Y.pow(Ic,d/999),l.c*=b,l.f*=b,1})}if(b(1)){var Jc=T.splice(0,1)[0];T.push(function(b,d,a){if(!b.J)return Jc(b,d,a)})}if(b(1)){var Kc=T.splice(0,1)[0],Lc=r(2),Mc=r(4E3)+999;T.push(function(b,d,a){var c=l.a/Mc|0;if(c%2&&Lc||c)return Kc(b,d,a)})}if(b(1)){var Nc=r(9)+3,Oc=T.splice(0,1)[0];T.push(function(b,d,a){if(b.W(l,Nc))return Oc(b,d,a)})}if(b(1)){var Pc=T.splice(0,1)[0],ic=b(1),Qc=r(9)+3;T.push(function(b,d,a){var c=b.W(l,Qc);if(c){c=c.z-c.b;var e=l.z-l.b;if(e>=c-1&&ic||e<=c+
1&&!ic)return Pc(b,d,a)}})}}if(1>qa&&b(3)){var Tb=1E-6*r()+1E-7,jc=1E6*Tb;T.unshift(function(b,d,a){if(a&2&&(b=b.W(l,9))&&(b=b.z-l.z))return a=l.h/jc,a=jc*a*a/2,a=a>(Y.abs(b)+a)/2,l.h+=(a&&0<b||!a&&0>b?-Tb:Tb)*d,2})}if(2==b(3)){if(r(2)){var kc=g>>6;var Ub=.9*k;var Eb=1}else if(.45<k||z)kc=g,Ub=k/2,Eb=r(2)*k|2;var lc=1==Eb?0:(k-Ub)/2;var mc=function(b,a){for(var c=Eb;c--&&a&&a.g>Bb;){var e=6*c/Eb;e=d(kc,l.x+V(e)*lc,l.y+Q(e)*lc,l.z,Ub);e.g=l.g;b.D(e)}}}if(b(1))T.push(function(b,a,d){if((l.c||l.f)&&
d&4)return b=Fa(l.f,l.c),l.l=b,4}),b(1)&&T.push(function(b,d,a){if((l.c||l.f)&&a&8)return b=O(l.c*l.c+l.f*l.f),l.s-=d*b/l.b,8});else{var Rc=.01*r()+.001;T.push(function(b,d,a){if(a&4)return b=O(l.c*l.c+l.f*l.f),l.l+=Rc*d*(b+.001),4})}var Sc=z;z||(z=(r(1E4)+2E4)*k);var Sb=[],db=0,eb=0,Ab=0,nc;.45<=k&&(nc=f(g,R,O(2*k)));var oc=k*k*2|0,l={i:1,ia:g,M:p++,b:k,qa:C,T:ia,x:D,y:K,z:y,ha:Ca,ga:function(b,d){var a=-1;T.map(function(c){(c=c(b,d,a))&&(a&=~c)});if(Ab){if(db||eb){var c=Fa(eb,db);db/=Ab;eb/=Ab;
var e=1-db*db-eb*eb;l.c+=V(c)*e/3E3;l.f+=Q(c)*e/3E3}eb=db=Ab=0}c=l.x-b.L;e=l.y-b.N;var f=l.z-b.ca;0<z&&l.a>z-(Sc?0:(c*c+e*e+f*f)*b.J/9)&&l.F(b);Sb=[]},G:function(b,a){if(a.i){if(a.g==vb&&l.g==Ib||a.g==Bb&&5==l.g||a.g==Ib&&l.g==vb)oc--,l.A=b.a,0>oc&&l.F(b,a);if(l.g==a.g){b=l.y-a.y;var d=a.b+l.b;db+=(l.x-a.x)/d;eb+=b/d;Ab++}}else l.g!=vb||l.ha||l.F(b,a);Sb.push(a)},S:function(){a.deleteBuffer(hc);a.deleteBuffer(fc);a.deleteBuffer(gc);a.deleteBuffer(ec);l.C&&l.C.ja()},F:function(b,a){if(!l.j&&(l.j=l.a,
mc&&mc(b,a),n&&n(b),a&&a!=l&&l.g==Ib)){a=k;var e=c(l.a)(),f=0>z;for(m(l.x,l.y,l.z,k);a-- >e;){var v=6*a/k,h=V(v);v=Q(v);f=d(f?g:4195348,l.x+.001*h,l.y+.001*v,l.z,f?.2:.05,5E3,null,.001);f.c=.005*h;f.f=.005*v;f.g=5;b.D(f);f=0}}},g:Ib,a:0,s:0,P:ha,l:0,c:0,f:0,h:0,A:0,ea:ec,oa:hc,pa:Ga.length,ta:fc,O:qa,xa:gc,K:function(){return{o:[l.x-l.b,l.y-l.b,l.z-l.b],u:[l.x+l.b,l.y+l.b,l.z+l.b]}},ma:R,C:nc};return l}function e(a){for(var d=1,c=1;a;){var e=c;c+=d;d=e;a--}return c}var f=cc(g,c),m=dc(g,.7,.1,777,
.7,.4),p=0;return d}
function pc(a,c){function g(a,d){if(a=qc(a,y,2,z))for(var c=a.o[1],b=a.u[0],e=a.u[1],f=a.o[0];f<=b;f++)for(var g=c;g<=e;g++)d(n.da(f,g),f,g);return a}function d(a){a.g%2&&0<a.i&&(a.qa=fb,a.T=gb);return g(a.K(),function(d,c,b){!a.i&&a.v==c&&a.w==b&&a.floor?d.unshift(a):d.push(a)})}function e(a){a.i&&(rc(n.Z,a),1==a.i&&a.C&&a.C.ja());var d=n.m[a.g];d&&rc(d,a);-1!=a.i&&f(a);a.S()}function f(a){return g(a.K(),function(d){rc(d,a)})}function m(a){function c(){k--;var b=n.Z[k];b.a+=a;if(1==b.i&&b.j)b.a>
b.j+399&&e(b);else if(1==b.i&&!qc(b.K(),y,2,z)||-1==b.i&&!sc(y,b.v,b.w))e(b);else{var c=void 0;b.ga(n,a);if(0<b.i){b.h-=5E-5*a*b.O;for(var v=a,w=9,u=2*b.b/a,p=u*u,m=function(){var a=b.x,e=b.y,k=b.z,q=b.c*v,m=b.f*v,r=b.h*v;f(b);var t=b.c*b.c+b.f*b.f+b.h*b.h;t>p&&(t=O(t),b.c*=u/t,b.f*=u/t,b.h*=u/t);b.x+=q;b.y+=m;b.z+=r;var z=b.K(),B,D,H,C={};g(z,function(d){function c(){var c=d[g];if(!C[c.M]&&!b.j){C[c.M]=1;var q=void 0,u=void 0;if(c.i){var m=c.x-b.x;var w=c.y-b.y,p=c.z-b.z,r=c.b+b.b;var t=b.c*b.c+
b.f*b.f+b.h*b.h;m*m+w*w+p*p<r*r&&t&&(c.G(n,b),c.j&&f(c),b.G(n,c))}else if(qc(c.K(),z,3,void 0)&&(w=Jb(b.x,b.y,b.z,c.$),p=w[2],Y.abs(p)<b.b)){var A,I=w;r=Jb(a,e,k,c.$);m=Jb(b.c,b.f,b.h,c.aa);m=m[2];t=void 0;0<m?(t=b.b+p,t/=m):(t=b.b-p,t/=-m);t=v-t;var y=tc(c.H,r,b.b);if(y){var x=y[0]-r[0];y=y[1]-r[1];var E=r[2];(x*x+y*y+E*E<b.b*b.b||uc(c.H,r[0],r[1])&&E<b.b)&&b.g!=Bb&&b.F(n)}if(t<=v){u=vc(w,Jb(a,e,k,c.$),t/v);if(0>m&&uc(c.H,u[0],u[1])&&0<t)q=t-.001;else if(u=O(b.b*b.b-p*p),(A=tc(c.H,w,u))||uc(c.H,
w[0],w[1])){u=ja(0,t-.001);w=v;for(p=0;9>p;p++)if(r=(u+w)/2,t=Jb(a+r*b.c,e+r*b.f,k+r*b.h,c.$),x=t[2],x=O(b.b*b.b-x*x),uc(c.H,t[0],t[1])&&0>m)w=r,I=t,A=null;else if(x=tc(c.H,t,x)){y=x[0]-t[0];E=x[1]-t[1];var G=t[2];y*y+E*E+G*G<b.b*b.b?(I=t,A=x,w=r):u=r}else u=r;A?(m=Fa(A[1]-I[1],A[0]-I[0])-Ma,m=wc([Z(1,0,0,Y.acos(I[2]/b.b)),Z(0,0,1,m),c.aa]),0>Jb(b.c,b.f,b.h,m)[2]&&(q=u)):q=u}u=function(){var a=b.c,d=b.f,e=b.h,f=b.ha;if(A){var g=Fa(A[1]-I[1],A[0]-I[0])-Ma;var k=Y.acos(I[2]/b.b);var v=wc([Z(1,0,0,k),
Z(0,0,1,g),c.aa]);g=wc([c.sa,Z(0,0,1,-g),Z(1,0,0,-k)])}else v=c.aa,g=c.sa;a=Jb(a,d,e,v);f=Jb(a[0],a[1],a[2]*-f,g);b.c=f[0];b.f=f[1];b.h=f[2]}}}null!=q&&(null==B||B>q)&&(D=c,B=q,H=u)}}for(var g=d.length;g--;)c()});null!=B?(q=ja(0,B),b.x=a+b.c*q,b.y=e+b.f*q,b.z=k+b.h*q,v-=q,q=D,q.G&&q.G(n,b),b.G(n,D),H&&H(),c=!w--||.001>=v||b.j):(b.j||(d(b),b.C&&(q=n.L-b.x,m=n.N-b.y,r=n.ca-b.z,q*q+m*m+r*r<99*b.b*b.b*4?b.C.za(b.x,b.y,b.z):b.C.ja())),c=!0)};!c;)m();b.Ca=[b.x,b.y,b.z];b.Da=[b.c,b.f,b.h]}}}n.J=n.R;n.R=
0;n.a+=a;for(var k=n.Z.length;k;)c()}for(var p=[],B=0;12>B;B++){for(var D=[],K=0;12>K;K++)D.push([]);p.push(D)}var y,k=0,z=[12,12],n={a:0,Z:[c],m:{0:[],1:[c],2:[],3:[],4:[],5:[]},R:0,J:0,da:function(a,d){var c;sc(y,a,d)&&(c=p[(a%12+12)%12][(d%12+12)%12]);return c},W:function(a,d){return n.V(a.x,a.y,a.g==vb?Ib:Bb,d)},V:function(a,d,c,b){c=n.m[c];b||(b=144);var e,f=b*b;c.map(function(b){var c=a-b.x,g=d-b.y;c=c*c+g*g;if(c<f||!f)e=b,f=c});return e},D:function(a){if(-1==a.i?sc(y,a.v,a.w):d(a)){var c=n.m[a.g];
c?c.push(a):n.m[a.g]=[a];a.i&&n.Z.push(a)}},Aa:function(a){for(a+=k;9<=a;)m(9),a-=9;k=a},ua:function(d,c,f,b,g,k){n.L=d;n.N=c;n.ca=f;n.wa=b;n.Ba=g;n.ba=k;g=fa(d/12-6);f=fa(c/12-6);d=fa(d/12+6)-1;c=fa(c/12+6)-1;if(null==y)for(y={o:[g,f],u:[d,c]};g<=d;g++)for(k=f;k<=c;k++){var m=a(g,k,n);m.map(n.D)}else if(g!=y.o[0]||f!=y.o[1])for(b=y,y={o:[g,f],u:[d,c]};g<=d;g++)for(k=f;k<=c;k++)sc(b,g,k)||(m=n.da(g,k),m.map(function(a){a.i||sc(y,a.v,a.w)||e(a)}),m.length=0,m=a(g,k,n),m.map(n.D))}};n.ua(c.x,c.y,c.z,
0,0,0);d(c);return n}function xc(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Zb(a,c){for(var g=[],d=0;16>d;d++){for(var e=d>>2,f=d%4,m=0,p=0;4>p;p++)m+=a[e+4*p]*c[p+4*f];g[e+4*f]=m}return g}function wc(a){var c=xc();a.map(function(a){a&&(c=Zb(c,a))});return c}function Z(a,c,g,d){var e=Q(d);d=V(d);var f=1-d;return[a*a*f+d,c*a*f-g*e,g*a*f-c*e,0,a*c*f+g*e,c*c*f+d,g*c*f-a*e,0,a*g*f+c*e,c*g*f+a*e,g*g*f+d,0,0,0,0,1]}function $b(a,c,g){return[1,0,0,0,0,1,0,0,0,0,1,0,a,c,g,1]}
function yc(a){return function(c){var g=a+c;return function(a){var d=1E5*Q(g++);d-=fa(d);a&&(d=d*a|0);return d}}}function sc(a,c,g){return a.o[0]<=c&&a.o[1]<=g&&a.u[0]>=c&&a.u[1]>=g}function qc(a,c,g,d){for(var e=!0,f=[],m=[],p=0;p<g;p++){var B=a.o[p],D=a.u[p],K=c.o[p],y=c.u[p];d&&(B=fa(B/d[p]),D=fa(D/d[p]));D=X(D,y);B=ja(B,K);K=D-B;if(e=e&&0<=K)f.push(B),m.push(D)}if(e)return{o:f,u:m}}
function Jb(a,c,g,d){var e=d[3]*a+d[7]*c+d[11]*g+d[15]||1;return[(d[0]*a+d[4]*c+d[8]*g+d[12])/e,(d[1]*a+d[5]*c+d[9]*g+d[13])/e,(d[2]*a+d[6]*c+d[10]*g+d[14])/e]}function Gb(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]}function vc(a,c,g){for(var d=[],e=c.length;e--;)d[e]=a[e]*g+c[e]*(1-g);return d}function Fb(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]}
function uc(a,c,g){for(var d,e=0,f=a.length-1;e<a.length;f=e++){var m=a[e][0],p=a[e][1],B=a[f][0];f=a[f][1];p>g!=f>g&&c<(B-m)*(g-p)/(f-p)+m&&(d=!d)}return d}function tc(a,c,g){var d=c[0],e=c[1],f=a[a.length-1];g*=g;for(var m=0;m<a.length;m++){var p=a[m],B=void 0,D=((d-f[0])*(p[0]-f[0])+(e-f[1])*(p[1]-f[1]))/zc(f,p);0>D?B=f:1<D?B=p:B=[f[0]+D*(p[0]-f[0]),f[1]+D*(p[1]-f[1])];D=zc(c,B);f=p;if(D<g){var K=B;g=D}}return K}function zc(a,c){var g=a[0]-c[0];a=a[1]-c[1];return g*g+a*a}
function Ac(a){a&&a.disconnect()}function Bc(a,c,g,d,e,f,m){a.gain.value=0;a.gain.setValueAtTime(0,c);a.gain.linearRampToValueAtTime(g,c+e);a.gain.linearRampToValueAtTime(d,c+f);a.gain.linearRampToValueAtTime(0,c+m)}
function dc(a,c,g,d,e,f){var m=a.sampleRate,p=c*m|0,B=a.createBuffer(1,p,m);for(m=B.getChannelData(0);p--;)m[p]=2*Y.random()-1;return function(m,p,y,k){k||(k=1);var z=a.createBufferSource();z.buffer=B;z.loop=!0;var n=a.createBiquadFilter();n.type="lowpass";n.Q.value=0;n.frequency.value=d;var v=a.createGain();Bc(v,a.currentTime,e*k,f*k,g,.2*c,c);var u=a.createPanner();u.refDistance=27*e;u.distanceModel="exponential";u.setPosition(m,p,y);z.connect(n);n.connect(v);v.connect(u);u.connect(a.destination);
z.start();z.stop(a.currentTime+c);z.onended=function(){[u,v,z,n].map(Ac)}}}
function ub(a,c,g,d,e,f,m,p,B,D){return function(K,y,k){var z=a.currentTime,n=a.createOscillator();n.frequency.setValueAtTime(f,z);n.frequency.linearRampToValueAtTime(m,z+c);n.type=e;var v=a.createGain();Bc(v,z,g,d,0,.2*c,c);if(B){var u=a.createOscillator();u.frequency.value=D;u.type=B;var w=a.createGain();w.gain.value=-999;u.connect(w);w.connect(n.detune);u.start();u.stop(z+c)}if(p){var b=a.createBiquadFilter();b.type="highpass";b.Q.value=0;b.frequency.value=p;n.connect(b);b.connect(v)}else n.connect(v);
var q=a.createPanner();q.refDistance=27*g;q.distanceModel="exponential";v.connect(q);q.connect(a.destination);q.setPosition(K,y,k);n.start();n.stop(z+c);n.onended=function(){[n,v,u,w,b].map(Ac)}}}
function cc(a,c){var g=["sine","sawtooth","triangle","square"];return function(d,e,f){var m,p,B,D,K,y=c(d),k=g[y(4)],z=g[y(3)];return{za:function(d,c,g){if(!m){m=a.createOscillator();var n=y(9);m.frequency.value=40-4*f+n*n*n;m.type=k;p=a.createGain();p.gain.value=.1*f/2;B=a.createOscillator();B.frequency.value=999*(y(2)+1)/e;B.type=z;D=a.createGain();D.gain.value=-999;K=a.createPanner();K.refDistance=3*(f+1)/2;K.distanceModel="exponential";m.connect(p);B.connect(D);D.connect(m.detune);p.connect(K);
K.connect(a.destination);B.start();m.start()}K.setPosition(d,c,g)},ja:function(){m&&([m,p,D,K].map(Ac),m.stop(),B.stop(),m=null)}}}}function rc(a,c){for(var g=a.length;0<g;)g--,a[g]==c&&a.splice(g,1)}function Xb(a,c){return Yb(a,a.ARRAY_BUFFER,new Float32Array(c))}function Yb(a,c,g){var d=a.createBuffer();a.bindBuffer(c,d);a.bufferData(c,g,a.STATIC_DRAW);return d}function Tc(a,c,g){a.bindBuffer(a.ARRAY_BUFFER,c);a.vertexAttribPointer(g,4,a.FLOAT,!1,0,0);a.enableVertexAttribArray(g)}
function ac(a,c,g,d){var e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,c,g,0,a.RGBA,a.UNSIGNED_BYTE,d);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);return e}
function Uc(a,c,g){c=a.createShader(c);a.shaderSource(c,g);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))throw console.error("An error occurred compiling shader",g,a.getShaderInfoLog(c)),a.deleteShader(c),"shader compilation error";return c}
function Vc(a,c){for(var g="uProjectionMatrix_ uModelMatrix_ uViewMatrix_ uPreviousViewMatrix_ uFillColor_ uLineColor_ uCameraLight_ uAmbientLight_ uPrevious_ uPreviousDimension_ uGridMode_ uGridDimension_ uGridLighting_ uCycleRadians_ uOffsetMultiplier_ uDirectedLightingNormal_ uDirectedLightingRange_ uSurfaceNormal_ uPowerSources_ uPowerSourceCount_ uGridTexture_".split(" "),d=[],e={},f=0;f<g.length;f++){var m=g[f];e[m]=a.getUniformLocation(c,m)}for(g=0;g<d.length;g++)f=d[g],e[f]=a.getAttribLocation(c,
f);return e}var Wc;window.webkitAudioContext?Wc=new window.webkitAudioContext:Wc=new AudioContext;
(function(a){function c(){function b(c){da=requestAnimationFrame(b);var e=X(99,c-ab);ab=c;F.Aa(e);d.activeTexture(L);d.bindTexture(r,N);d.framebufferTexture2D(B,v,r,N,0);c=0;h.j&&(c=Q(X(1.5,(F.a-h.j)/999)));F.ua(h.x,h.y,h.z+h.b+72*c/2,(h.s+1.5)*(1-c),h.P,h.l-1.5);c=a.listener;c.setPosition(h.x,h.y,h.z);c.setOrientation(V(h.l),Q(h.l),0,0,0,1);c=ja(0,(za+99-F.a)/3E3);e=$b(Q(wa)*h.b/8+(W()-.5)*c,c,Y.abs(V(wa)*h.b/8)+(W()-.5)*c);c=Z(1,0,0,F.wa);var g=Z(0,0,1,F.ba),n=Z(0,1,0,-h.s);ob=wc([qb,Z(0,0,1,-h.l),
n,pb,$b(.6*h.b/2+.05,0,0)]);h.ya=wc([qb,n,pb,[.6,0,0,0,0,.1,0,0,0,0,.1,0,0,0,0,1],Z(1,0,0,-.5),Z(0,1,0,1.5+h.s)]);e=wc([c,e,g,$b(-F.L,-F.N,-F.ca)]);F.m[wb].sort(function(a,b){var c=F.L-12*a.v;a=F.N-12*a.w;var d=F.L-12*b.v;b=F.N-12*b.w;return c*c+a*a-d*d-b*b});k(ia,e,rb);rb=e;e=M;M=N;N=e;d.readPixels(0,0,C,E,G,H,ka);A.data.set(ka);f.putImageData(A,0,0);f.globalCompositeOperation="destination-over";e=void 0;e=Zb(ia,c);c=(Jb(0,1,.2,e)[1]*E-E)/2|0;g=Ka/pa*C;g=((F.ba-1.5)%Ka+Ka)%Ka*C/pa%g-g/2+C/2;for(n=
F.ba*C/pa%C-C;n<C&&612>h.x;)f.drawImage(m,n,c),n+=C;e=(Jb(0,cb,Ra,e)[1]*E+E)/2;e=f.createRadialGradient(g,e,E/9,g,e,E);g=1+Q(F.a/999)/9;e.addColorStop(.1*g,ma);e.addColorStop(.11*g,Ha);e.addColorStop(1,ya);f.fillStyle=e;f.fillRect(0,0,C,c+E);f.fillStyle="#313";f.fillRect(0,ja(0,c+E),C,E);f.globalCompositeOperation="source-over";f.textBaseline="top";f.fillStyle=f.strokeStyle="#fff";f.globalAlpha=Y.abs(Q(F.a/99))/2+.5;f.font="18px sans-serif";f.textAlign="center";$a&&999>F.a-$a&&f.fillText(Cb,C/2,E/
2);f.textAlign="left";if(!h.j)for(c=void 0,c=X(1,1-(Da-F.a+399)/399),3<P&&(f.globalAlpha=c),f.lineWidth=9-7*c,c=30>P?"red":"#4f4",f.fillStyle=c,3>P&&(f.strokeStyle="red"),f.fillRect(C-oa-18,18,P,18),f.strokeRect(C-oa-18,18,oa,18),c=f.measureText("\u26a1").width,e=Ya,g=C-oa-27;0<e;)g-=c,f.fillText("\u26a1",g,18),e--;f.globalAlpha=1}function k(a,b,c){d.clear(I);for(var e=F.m[wb],g=[],f=X(e.length,16),k=Q(F.a/399)/9+1,m=0;m<f;m++){var p=e[m];g.push(12*p.v+6,12*p.w+6,O(p.I)*k+12,p.U/2)}d.uniform4fv(x.uPowerSources_,
g);d.uniform1i(x.uPowerSourceCount_,f);d.uniform1i(x.uPrevious_,0);d.uniform1i(x.uGridTexture_,1);d.bindTexture(r,M);d.activeTexture(Hb);d.uniform2f(x.uPreviousDimension_,1/C,1/E);d.uniformMatrix4fv(x.uProjectionMatrix_,!1,a);d.uniformMatrix4fv(x.uViewMatrix_,!1,b);d.uniformMatrix4fv(x.uPreviousViewMatrix_,!1,c);a=X(1.5,F.L/408);Ra=Q(a);cb=V(a);d.uniform4f(x.uDirectedLightingNormal_,cb,0,Ra,.1*(Ra+1));a=.5;b=ja(0,za+99-F.a)/99;a+=b;b=ja(0,.1*X(1,(P-30)/30),.5*(1-(F.a-h.A-399))/399);d.uniform4f(x.uCameraLight_,
9,a,.5-b,1.1+b);for(var q in F.m)q!=wb&&F.m[q].map(function(a){d.enable(w);Tc(d,a.ta,ua);Tc(d,a.ea,na);d.bindBuffer(n,a.oa);var b=a.T,c=.2;a.A&&a.A+199>F.a&&(c+=(a.A+199-F.a)/399);d.uniform1i(x.uGridMode_,a.i);if(a.i){var e=a.xa;var g=$b(a.x,a.y,a.z);var f=Z(0,1,0,-a.s);var k=Z(1,0,0,-a.P);var h=Z(0,0,1,-a.l);k=[g,h,a.ya,f,k];g=[0,0,0,0];if(f=F.da(fa(a.x/12),fa(a.y/12)))h=f[0],h.i||(g=h.na,!h.floor&&console.warn("got bad surface",h));var m=a.a/a.ma;h=0;f=a.qa;if(a.j){d.disable(w);h=(a.a-a.j)/399;
m=h*h;var p=1-.99*m;h=3*m*a.b/p;k.splice(1,0,[p,0,0,0,0,p,0,0,0,0,p,0,0,0,0,1]);f=vc(Sa,f,m);b=vc(Sa,b,m);m=a.j/a.ma+(a.a-a.j)/399}d.uniform1f(x.uCycleRadians_,6*m);d.uniform1f(x.uOffsetMultiplier_,h);k=wc(k)}else h=a,e=h.ea,k=h.ra,d.uniform3fv(x.uSurfaceNormal_,h.B),d.uniform3f(x.uGridDimension_,h.Y,h.ka,h.la&&h.fa?h.la.U:0),h.fa&&d.bindTexture(r,h.fa),d.uniform1fv(x.uGridLighting_,h.X),f=Va,g=h.na;Tc(d,e,Aa);d.uniformMatrix4fv(x.uModelMatrix_,!1,k);d.uniform4fv(x.uFillColor_,b);d.uniform3fv(x.uLineColor_,
f);d.uniform4fv(x.uDirectedLightingRange_,g);d.uniform1f(x.uAmbientLight_,c);d.drawElements(J,a.pa,t,0)})}function q(a,b,c,d){var e=Ua(a,b,c,d,.49);h=e;h.O=1-h.O/2;h.ha=0;h.C=null;h.g=Bb;h.F=function(){h.j=h.a;h==e&&(u("HULL FAILURE"),Ca(h.x,h.y,h.z))};h.ga=function(a,b){var c=ea[37]||ea[65],d=ea[39]||ea[68],e=ja(ea[38],ea[87]),f=ea[40]||ea[83],g=ea[32],k=.004;if(ea[16]||e<nb)k*=2;h.s=3*bb/E;h.l=3*Qa/C;var m=Q(h.l),n=V(h.l),p=Q(h.l-1.5),t=V(h.l-1.5),q=0,r=0;d&&(q+=.004*t,r+=.004*p);c&&(q-=.004*t,
r-=.004*p);c=V(wa);e&&(q+=k*n,r+=k*m,sa==h.a-b&&(wa+=k*b));f&&(q-=.004*n,r-=.004*m,sa==h.a-b&&(wa-=.004*b));e=V(wa);(0<=e&&0>c||0>e&&0<=c)&&Ga(h.x,h.y,h.z-h.b);g&&sa+699>g&&(h.h=.014,sa=0);h.c=q;h.f=r;g=0;if(sa+699>h.a)for(q=a.m[wb],r=0;r<q.length;)e=q[r++],f=h.x-(12*e.v+6),k=h.y-(12*e.w+6),f=f*f+k*k,f<e.I*e.I&&(f=O(f),f=e.U*(e.I-f)/e.I,g+=f*f*O(e.I)/4);Ya=O(g);P=X(oa,P+Ya*b*.011/X(1,(P+9)/30));mb&&3<=P&&(h.a>za+180||P>=oa)&&(P-=3,q=Q(h.s),r=V(h.s),za=za+180+b>h.a?za+180:h.a,b=Jb(0,0,0,ob),b=Ua(h.ia,
h.x+b[0],h.y+b[1],h.z+b[2],.1,450),Ba(h.x,h.y,h.z),b.g=vb,b.C=null,b.c=r*n*.02,b.f=r*m*.02,b.h=.02*q,b.O/=2,a.D(b));!Oa&&612<h.x&&(Oa=1,u("YOU ESCAPED"),sb.setItem(0,la+1),ma="#FF5",Ha="#CCC",ya="#99E");3<=va&&3>P&&!g?(u("WEAPON OFFLINE","WEAPON OFF LINE"),Ea=1):30<=va&&30>P&&!Za?(u("SHIELD OFFLINE","SHEELED OFF LINE"),Za=1):3>va&&3<=P&&Ea?(u("WEAPON ONLINE"),Ea=0):60<P&&(Za=0);va=P};h.G=function(a,b){if(b.i){if(b.g!=vb)if(5==b.g){if(4195348==b.ia)ra++,oa=Y.pow(ra,.8),P+=9,Da=a.a,qa(h.x,h.y,h.z);
else{var c=h;q(b.ia,h.x,h.y,h.z);h.s=c.s;h.P=c.P;h.l=c.l;c.j=c.a;h.a=c.a;a.D(h);u("WEAPON UPGRADE")}b.j=b.a}else h.A+399>a.a?b.j=b.a:(Wa(h.x,h.y,h.z),c=30/.45*b.b,P>=c?(P-=c,h.A=a.a,za=a.a+399,b.j=b.a):h.F(a,b))}else 0<b.B[2]&&(sa=h.a)}}function u(a,b){window.speechSynthesis&&(b=new SpeechSynthesisUtterance(b?b:a),b.rate=.8,speechSynthesis.speak(b),b.onend=function(){$a=F.a-999});Cb=a;$a=F.a}function y(){cancelAnimationFrame(da);for(var a in F.m)F.m[a].map(function(a){a.S()});z()}function z(a){C=
innerWidth;E=innerHeight;g.width=e.width=C;g.height=e.height=E;ka=new Uint8Array(C*E*4);A=f.createImageData(C,E);M&&(d.deleteTexture(M),d.deleteTexture(N),d.deleteFramebuffer(ha),d.deleteRenderbuffer(U));a&&(M=ac(d,C,E),N=ac(d,C,E),ha=d.createFramebuffer(),U=d.createRenderbuffer(),d.bindFramebuffer(B,ha),d.bindRenderbuffer(p,U),d.renderbufferStorage(p,D,C,E),d.framebufferRenderbuffer(B,K,p,U));ta=C/E;pa=2*Y.atan(.3936*ta);a=1/.3936;var b=1/-71.775;ia=[a/ta,0,0,0,0,-a,0,0,0,0,72.225*b,-1,0,0,32.4*
b,0];d.viewport(0,0,C,E);a=aa(0);for(b=5;--b;){f.fillStyle=Ta[b-2];for(var c=0;c<C;){var h=(a(E)+4*E)*O(6-b)/25+E/2,k=(a(C/19)+C/49)/(ta*b);f.fillRect(c,h,k+1,E);c+=k}}m.src=e.toDataURL()}var Oa,la;(la=sb.getItem(0)/1)||(la=7);var aa=yc(la),W=aa(9),da;z(1);onresize=z;var ba=sb.getItem(la),La;ba?La=JSON.parse(ba):La=[0,0,0];var Ua=bc(d,aa,a);ba=tb(la,R,Ua,aa,a,u,[lb,e]);var wa=0,h;q(0,La[0],La[1],La[2]+2);var za=h.P=0,ra=150,oa=Y.pow(ra,.8),P=oa,va=P,Da=0,sa=0,Ya=0,Ea,Za,F=pc(ba,h),$a,Cb,ab=0,Qa=0,
bb=0,mb,nb,ea={38:0,87:0};e.onmousedown=function(a){a.button||(lb.pointerLockElement==e?h.j?(y(),c()):mb=F.a:e.requestPointerLock())};e.onmouseup=function(){mb=0};e.onmousemove=function(a){lb.pointerLockElement==e&&(Qa-=a.movementX,bb=X(E/2,ja(-E/2,bb-a.movementY/2)))};onkeydown=function(a){a=a.keyCode;ea[a]||(ea[a]=F.a)};onkeyup=function(a){a=a.keyCode;ea[a]=0;16==a&&(nb=F.a)};var Ra,cb,ob,pb=$b(.6*h.b,.3*-h.b,.45*-h.b),qb=$b(0,0,h.b);var rb=xc();b(0)}var g=lb.createElement("canvas"),d=g.getContext("webgl"),
e=lb.getElementById("b"),f=e.getContext("2d"),m=lb.createElement("img"),p=d.RENDERBUFFER,B=d.FRAMEBUFFER,D=d.DEPTH_COMPONENT16,K=d.DEPTH_ATTACHMENT,y=d.VERTEX_SHADER,k=d.FRAGMENT_SHADER,z=d.LINK_STATUS,n=d.ELEMENT_ARRAY_BUFFER,v=d.COLOR_ATTACHMENT0,u=d.DEPTH_TEST,w=d.CULL_FACE,b=d.LESS,q=d.FRONT,I=d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT,r=d.TEXTURE_2D,H=d.UNSIGNED_BYTE,t=d.UNSIGNED_SHORT,G=d.RGBA,J=d.TRIANGLES,L=d.TEXTURE0,Hb=d.TEXTURE1,R=Wb(d),ka,A,M,N,ha,U,ia,C,E,ta,pa,Ba=dc(a,.3,.01,399,.9,.5),qa=
ub(a,.2,.1,.05,"square",999,2E3,599),Ca=dc(a,2,.2,499,1.5,1),Wa=ub(a,.5,.4,.2,"sawtooth",299,-99),Ga=dc(a,.05,.01,2E3,.1,.05),ma="#000",Ha="#c6c",ya="#112";d.getExtension("OES_standard_derivatives");d.enable(u);d.depthFunc(b);d.clearColor(0,0,0,0);d.cullFace(q);y=Uc(d,y,"precision lowp float;\nattribute vec4 aVertexPosition_;\nattribute vec4 aVertexOffset_;\nattribute vec4 aGridCoordinate_;\nuniform mat4 uModelMatrix_;\nuniform mat4 uViewMatrix_;\nuniform mat4 uPreviousViewMatrix_;\nuniform mat4 uProjectionMatrix_;\nuniform vec3 uSurfaceNormal_;\nuniform vec4 uDirectedLightingNormal_;\nuniform lowp int uGridMode_;\nuniform float uCycleRadians_;\nuniform float uOffsetMultiplier_;\nvarying vec4 vVertexPosition_;\nvarying vec4 vRelativePosition_;\nvarying vec4 vGridCoordinate_;\nvarying vec4 vScreenCoordinate_;\nvarying vec4 vNormalLighting_;\nvoid main(){\n    vec4 adjustedVertePosition_=aVertexPosition_;\n    vec3 vertexNormal_=uSurfaceNormal_;\n    if(uGridMode_>0){\n        adjustedVertePosition_+=aVertexOffset_.w*aVertexPosition_*sin(uCycleRadians_+aGridCoordinate_.w)+uOffsetMultiplier_*aVertexOffset_;\n        vertexNormal_=(uModelMatrix_*vec4(aVertexPosition_.xyz/aVertexPosition_.w,1.)-uModelMatrix_*vec4(vec3(0.), 1.)).xyz;\n    }\n    vec4 vertexPosition_=uModelMatrix_*vec4(adjustedVertePosition_.xyz,1.);\n    adjustedVertePosition_=uViewMatrix_*vertexPosition_;\n    vGridCoordinate_=aGridCoordinate_;\n    vRelativePosition_=adjustedVertePosition_;    \n    vScreenCoordinate_=uProjectionMatrix_*uPreviousViewMatrix_*vertexPosition_;\n    vNormalLighting_=vec4(mat3(uViewMatrix_)*vertexNormal_-mat3(uViewMatrix_)*vec3(0.),(dot(vertexNormal_,uDirectedLightingNormal_.xyz)+1.)*uDirectedLightingNormal_.w);\n    vVertexPosition_=vec4(vertexPosition_.xyz,aVertexPosition_.w);\n    gl_Position=uProjectionMatrix_*adjustedVertePosition_;\n}");
k=Uc(d,k,"#extension GL_OES_standard_derivatives:enable\nprecision lowp float;\nuniform vec4 uFillColor_;\nuniform vec3 uLineColor_;\nuniform vec4 uCameraLight_;\nuniform float uAmbientLight_;\nuniform sampler2D uPrevious_;\nuniform sampler2D uGridTexture_;\nuniform vec2 uPreviousDimension_;\nuniform lowp int uGridMode_;\nuniform vec3 uGridDimension_;\nuniform float uGridLighting_[4];\nuniform vec4 uDirectedLightingRange_;\nuniform vec4 uPowerSources_[16];\nuniform lowp int uPowerSourceCount_;\nvarying vec4 vVertexPosition_;\nvarying vec4 vRelativePosition_;\nvarying vec4 vGridCoordinate_;\nvarying vec4 vScreenCoordinate_;\nvarying vec4 vNormalLighting_;\nvec4 getSampleColor_(vec2 screenCoordinate_,int div_,inout float count_){\n    vec4 previousColor_=texture2D(uPrevious_,screenCoordinate_);\n    if(previousColor_.w>.1){\n        float mult_=7./float(7-div_); \n        count_+=mult_;\n        previousColor_*=mult_;\n    }\n    return previousColor_;\n}\nvoid main(){\n    float distance_=length(vRelativePosition_.xyz);\n    float fogginess_=0.;\n    if(distance_<72.){\n        fogginess_=clamp((5184.-distance_*distance_)/5184.,0.,1.);\n    }\n    vec3 gridColor_=vec3(0.);\n    float gridPower_=0.;\n    for(int i=0;i<16;i++){\n        if(i<uPowerSourceCount_){\n            vec4 powerSource_=uPowerSources_[i];\n            vec2 powerSourceDelta_=powerSource_.xy-vVertexPosition_.xy;\n            float powerSourceDistance_=sqrt(powerSourceDelta_.x*powerSourceDelta_.x+powerSourceDelta_.y*powerSourceDelta_.y);\n            if(powerSourceDistance_<powerSource_.z){\n                float p_=(powerSource_.z-powerSourceDistance_)/powerSource_.z;\n                float psq_=p_*p_*sqrt(powerSource_.z)/4.;\n                gridPower_+=psq_;\n                gridColor_+=vec3(.5,powerSource_.w,.5-powerSource_.w)*psq_;\n            }\n        }\n    }\n    if(gridPower_>0.){\n        gridColor_/=gridPower_;\n    }\n    float lighting_=clamp(1.-distance_/uCameraLight_.x,0.,1.)*-dot(vRelativePosition_.xyz/distance_,vNormalLighting_.xyz)*uCameraLight_.y+uAmbientLight_+vNormalLighting_.w+gridPower_/9.;\n    float tileness_=1.;\n    vec3 fillColor_;\n    vec3 lineColor_;\n    vec4 floorGridCoordinate_=floor(vGridCoordinate_);\n    if(uGridMode_>0){\n        vec3 a3_=smoothstep(vec3(0.0),fwidth(vGridCoordinate_.xyz)*2.*vVertexPosition_.w*(1.-distance_/72.),vGridCoordinate_.xyz);\n        tileness_=min(min(a3_.x,a3_.y),a3_.z);\n        fillColor_=uFillColor_.xyz;\n        lineColor_=uLineColor_;\n        lighting_+=uFillColor_.w;\n    }else{ \n        float mn_=min(vGridCoordinate_.x-floorGridCoordinate_.x,(vGridCoordinate_.y-floorGridCoordinate_.y)*vGridCoordinate_.z);\n        float mx_=max(vGridCoordinate_.x-floorGridCoordinate_.x,1.-(1.-vGridCoordinate_.y+floorGridCoordinate_.y)*vGridCoordinate_.z);\n        float lineWidth_=(1.+gridPower_*gridPower_)*vGridCoordinate_.w; \n        if(mn_<lineWidth_||mx_>(1.-lineWidth_)){\n            tileness_=min(mn_,1.-mx_)/lineWidth_*(1.-max(0.,distance_/72.))*(1.-lineWidth_)+lineWidth_;\n            tileness_*=tileness_*tileness_;\n        }\n        mn_ = floorGridCoordinate_.y*uGridDimension_.x+floorGridCoordinate_.x;\n        for(int i=0;i<4;i++){\n            if(mn_<24.&&mn_>=0.) {\n                lighting_=max(lighting_,mod(floor(uGridLighting_[i]/pow(2.,mn_)), 2.)*6.);\n            }\n            mn_-=24.;\n        }\n        gridColor_=mix(uLineColor_,gridColor_,sqrt(gridPower_));\n        lineColor_=gridColor_;\n        vec2 gradientPosition_=vGridCoordinate_.xy/uGridDimension_.xy-.5;\n        fillColor_=vec3(uFillColor_.xy, uFillColor_.z+uFillColor_.w*(gradientPosition_.x+gradientPosition_.y));\n        if(uGridDimension_.z>0.){\n            // reuse local var for the pixel texture for the surface\n            floorGridCoordinate_=texture2D(uGridTexture_,1.-vGridCoordinate_.yx/uGridDimension_.yx);\n            lighting_+=floorGridCoordinate_.w*6.*uGridDimension_.z;\n            tileness_=max(tileness_,floorGridCoordinate_.w*uGridDimension_.z);\n        }\n    }\n    vec4 currentColor_=vec4(mix(lineColor_,max(mix(vec3(0.),fillColor_,lighting_),gridColor_*.4*(1.-min((vVertexPosition_.z-(vVertexPosition_.x-uDirectedLightingRange_.x)*uDirectedLightingRange_.y-uDirectedLightingRange_.z)/uDirectedLightingRange_.w,1.))),tileness_), fogginess_);\n    vec2 textureCoordinate_=(vScreenCoordinate_.xy/vScreenCoordinate_.w)/2.+.5;\n    gridPower_=0.;\n    floorGridCoordinate_=getSampleColor_(textureCoordinate_,0,gridPower_);\n    for(int i=1;i<7;++i){\n        distance_=float(i);\n        floorGridCoordinate_+=getSampleColor_(textureCoordinate_+vec2(uPreviousDimension_.x,0.)*distance_,i,gridPower_);\n        floorGridCoordinate_+=getSampleColor_(textureCoordinate_-vec2(uPreviousDimension_.x,0.)*distance_,i,gridPower_);\n        floorGridCoordinate_+=getSampleColor_(textureCoordinate_+vec2(0.,uPreviousDimension_.y)*distance_,i,gridPower_);\n        floorGridCoordinate_+=getSampleColor_(textureCoordinate_-vec2(0.,uPreviousDimension_.y)*distance_,i,gridPower_);\n    }\n    if(gridPower_>0.){\n        floorGridCoordinate_/=gridPower_;\n        gridPower_=sqrt(floorGridCoordinate_.w)*uCameraLight_.z;\n        currentColor_=vec4((currentColor_.xyz*gridPower_+floorGridCoordinate_.xyz*(1.-gridPower_))*uCameraLight_.w,currentColor_.a);\n    }\n    gl_FragColor=currentColor_;\n}");
u=d.createProgram();d.attachShader(u,y);d.attachShader(u,k);d.linkProgram(u);if(!d.getProgramParameter(u,z))throw console.error("An error occurred linking program",d.getProgramInfoLog(u)),"program link error";d.useProgram(u);var ua=d.getAttribLocation(u,"aVertexPosition_"),na=d.getAttribLocation(u,"aGridCoordinate_"),Aa=d.getAttribLocation(u,"aVertexOffset_"),x={};x=Vc(d,u);return c})(Wc)();</script></canvas>